UPDATE eform SET status=1 WHERE fid=1 AND form_name='letter';
UPDATE eform SET form_html='<html><head>\r\n<meta http-equiv="content-type" content="text/html; charset=UTF-8">\r\n\r\n<title>Rich Text Letter</title>\r\n<style type="text/css">\r\n.butn {width: 140px;}\r\n</style>\r\n\r\n<style type="text/css" media="print">\r\n.DoNotPrint {display: none;}\r\n\r\n</style>\r\n\r\n<script language="javascript" type="text/javascript" src="${oscar_javascript_path}jquery/jquery-1.4.2.js"></script>\r\n\r\n<script language="javascript">\r\nvar needToConfirm = false;\r\n\r\n//keypress events trigger dirty flag for the iFrame and the subject line\r\ndocument.onkeyup=setDirtyFlag\r\n\r\n\r\nfunction setDirtyFlag() {\r\n	needToConfirm = true; \r\n}\r\n\r\nfunction releaseDirtyFlag() {\r\n	needToConfirm = false; //Call this function if dosent requires an alert.\r\n	//this could be called when save button is clicked\r\n}\r\n\r\n\r\nwindow.onbeforeunload = confirmExit;\r\n\r\nfunction confirmExit() {\r\n	if (needToConfirm)\r\n	return "You have attempted to leave this page. If you have made any changes without clicking the Submit button, your changes will be lost. Are you sure you want to exit this page?";\r\n}\r\n\r\n</script>\r\n\r\n\r\n\r\n</head><body onload="Start()" bgcolor="FFFFFF">\r\n\r\n\r\n<!-- START OF EDITCONTROL CODE --> \r\n\r\n<script language="javascript" type="text/javascript" src="${oscar_image_path}editControl.js"></script>\r\n      \r\n<script language="javascript">\r\n\r\n    //put any of the optional configuration variables that you want here\r\n    cfg_width = \'640\';                    //editor control width in pixels\r\n    cfg_height = \'520\';                   //editor control height in pixels\r\n    cfg_editorname = \'edit\';                //the handle for the editor                  \r\n    cfg_isrc = \'${oscar_image_path}\';         //location of the button icon files\r\n    cfg_filesrc = \'${oscar_image_path}\';         //location of the html files\r\n    cfg_template = \'blank.html\';	    //default style and content template\r\n    cfg_formattemplate = \'<option value=""> template </option>  <option value="blank">blank</option>  <option value="consult">consult</option> <option value="certificate">work note</option> <option value="narcotic">narcotic contract</option> <option value="MissedAppointment">missed appt</option> <option value="custom">custom</option></select>\';\r\n    //cfg_layout = \'[all]\';             //adjust the format of the buttons here\r\n    cfg_layout = \r\n\'<table style="background-color:#ccccff; width:640px"><tr id=control1><td>[bold][italic][underlined][strike][subscript][superscript]|[left][center][full][right]|[unordered][ordered][rule]|[undo][redo]|[indent][outdent][select-all][clean]|[table]</td></tr><tr id=control2><td>[select-block][select-face][select-size][select-template]|[image][clock][date][spell][help]</td></tr></table>[edit-area]\';\r\n    insertEditControl(); // Initialise the edit control and sets it at this point in the webpage\r\n\r\n    function Start() {\r\n        // set eventlistener for the iframe to flag changes in the text displayed \r\n	var agent=navigator.userAgent.toLowerCase(); //for non IE browsers\r\n        if ((agent.indexOf("msie") == -1) || (agent.indexOf("opera") != -1)){\r\n		document.getElementById(cfg_editorname).contentWindow.addEventListener(\'keypress\',setDirtyFlag, true);\r\n	}\r\n\r\n	if (document.getElementById(\'recent_rx\').value.length<1){\r\n		//document.RichTextLetter.RecentMedications.style.visibility="hidden";\r\n		document.getElementById(\'RecentMedications\').style.display = "none";\r\n	}\r\n\r\n        // reformat values of multiline database values from \\\\n lines to <br>\r\n        htmlLine(\'label\');\r\n        htmlLine(\'reminders\');\r\n        htmlLine(\'ongoingconcerns\');\r\n        htmlLine(\'medical_history\');document.getElementById(\'allergies_des\').value\r\n        htmlLine(\'other_medications_history\');  //family history  ... don\'t ask\r\n        htmlLine(\'social_family_history\');  //social history\r\n        htmlLine(\'address\');\r\n        htmlLine(\'NameAddress\');\r\n        htmlLine(\'clinic_label\');\r\n        htmlLine(\'clinic_address\');\r\n        htmlLine(\'druglist_generic\');\r\n        htmlLine(\'druglist_trade\');\r\n        htmlLine(\'recent_rx\');\r\n\r\n	var gender=document.getElementById(\'sex\').value; \r\n	if (gender==\'F\'){\r\n		document.getElementById(\'he_she\').value=\'she\'; \r\n		document.getElementById(\'his_her\').value=\'her\';\r\n		document.getElementById(\'gender\').value=\'female\';\r\n	}\r\n	var mySplitResult = document.getElementById(\'referral_name\').value.toString().split(\',\'); \r\n	document.getElementById(\'referral_nameL\').value=mySplitResult[0];\r\n\r\n	document.getElementById(\'letterhead\').value= genericLetterhead();\r\n\r\n	\r\n        // set the HTML contents of this edit control from the value saved in Oscar (if any)\r\n	var contents=document.getElementById(\'Letter\').value\r\n	if (contents.length==0){\r\n		parseTemplate();\r\n	} else {\r\n		seteditControlContents(cfg_editorname,contents);\r\n	}\r\n    }\r\n \r\n    function htmlLine(theelement) { \r\n	var temp = new Array();\r\n	if (document.getElementById(theelement).value.length>0){\r\n		temp=document.getElementById(theelement).value.split(\'\\\\n\'); \r\n		contents=\'\';\r\n		var x;\r\n		for (x in temp) {\r\n			contents += temp[x]+\'<br>\';\r\n			}\r\n		document.getElementById(theelement).value=contents;\r\n		}\r\n    }\r\n\r\n    function genericLetterhead() {\r\n        // set the HTML contents of the letterhead\r\n	var address = \'<table border=0><tbody><tr><td><font size=6>\'+document.getElementById(\'clinic_name\').value+\'</font></td></tr><tr><td><font size=2>\'+ document.getElementById(\'clinic_addressLineFull\').value+ \' Fax: \'+document.getElementById(\'clinic_fax\').value+\' Phone: \'+document.getElementById(\'clinic_phone\').value+\'</font><hr></td></tr></tbody></table><br>\'\r\n	if ((document.getElementById(\'clinic_name\').value.toLowerCase()).indexOf(\'amily health team\',0)>-1){\r\n		address=fhtLetterhead();\r\n	}\r\n	return address;\r\n    }\r\n\r\n    function fhtLetterhead() {\r\n        // set the HTML contents of the letterhead using FHT colours\r\n	var address = document.getElementById(\'clinic_addressLineFull\').value+ \'<br>Fax:\'+document.getElementById(\'clinic_fax\').value+\' Phone:\'+document.getElementById(\'clinic_phone\').value ;\r\n	if (document.getElementById(\'doctor\').value.indexOf(\'zapski\')>0){address=\'293 Meridian Avenue, Haileybury, ON P0J 1K0<br> Tel 705-672-2442 Fax 705-672-2384\'};\r\n	address=\'<table style=\\\'text-align: right;\\\' border=\\\'0\\\'><tbody><tr style=\\\'font-style: italic; color: rgb(71, 127, 128);\\\'><td><font size=\\\'+2\\\'>\'+document.getElementById(\'clinic_name\').value+\'</font> <hr style=\\\'width: 100%; height: 3px; color: rgb(212, 118, 0); background-color: rgb(212, 118, 0);\\\'></td> </tr> <tr style=\\\'color: rgb(71, 127, 128);\\\'> <td><font size=\\\'+1\\\'>Family Health Team<br> &Eacute;quipe Sant&eacute; Familiale</font></td> </tr> <tr style=\\\'color: rgb(212, 118, 0); \\\'> <td><small>\'+address+\'</small></td> </tr> </tbody> </table>\';\r\n	return address;\r\n    }\r\n</script>\r\n\r\n<!-- END OF EDITCONTROL CODE -->\r\n\r\n\r\n<form method="post" action="" name="RichTextLetter" >\r\n\r\n<!-- START OF DATABASE PLACEHOLDERS -->\r\n\r\n<input type="hidden" name="clinic_name" id="clinic_name" oscarDB=clinic_name>\r\n<input type="hidden" name="clinic_address" id="clinic_address" oscarDB=clinic_address>\r\n<input type="hidden" name="clinic_addressLine" id="clinic_addressLine" oscarDB=clinic_addressLine>\r\n<input type="hidden" name="clinic_addressLineFull" id="clinic_addressLineFull" oscarDB=clinic_addressLineFull>\r\n<input type="hidden" name="clinic_label" id="clinic_label" oscarDB=clinic_label>\r\n<input type="hidden" name="clinic_fax" id="clinic_fax" oscarDB=clinic_fax>\r\n<input type="hidden" name="clinic_phone" id="clinic_phone" oscarDB=clinic_phone>\r\n<input type="hidden" name="clinic_city" id="clinic_city" oscarDB=clinic_city>\r\n<input type="hidden" name="clinic_province" id="clinic_province" oscarDB=clinic_province>\r\n<input type="hidden" name="clinic_postal" id="clinic_postal" oscarDB=clinic_postal>\r\n\r\n<input type="hidden" name="patient_name" id="patient_name" oscarDB=patient_name>\r\n<input type="hidden" name="first_last_name" id="first_last_name" oscarDB=first_last_name>\r\n<input type="hidden" name="patient_nameF" id="patient_nameF" oscarDB=patient_nameF >\r\n<input type="hidden" name="patient_nameL" id="patient_nameL" oscarDB=patient_nameL >\r\n<input type="hidden" name="label" id="label" oscarDB=label>\r\n<input type="hidden" name="NameAddress" id="NameAddress" oscarDB=NameAddress>\r\n<input type="hidden" name="address" id="address" oscarDB=address>\r\n<input type="hidden" name="addressline" id="addressline" oscarDB=addressline>\r\n<input type="hidden" name="phone" id="phone" oscarDB=phone>\r\n<input type="hidden" name="phone2" id="phone2" oscarDB=phone2>\r\n<input type="hidden" name="province" id="province" oscarDB=province>\r\n<input type="hidden" name="city" id="city" oscarDB=city>\r\n<input type="hidden" name="postal" id="postal" oscarDB=postal>\r\n<input type="hidden" name="dob" id="dob" oscarDB=dob>\r\n<input type="hidden" name="dobc" id="dobc" oscarDB=dobc>\r\n<input type="hidden" name="dobc2" id="dobc2" oscarDB=dobc2>\r\n<input type="hidden" name="hin" id="hin" oscarDB=hin>\r\n<input type="hidden" name="hinc" id="hinc" oscarDB=hinc>\r\n<input type="hidden" name="hinversion" id="hinversion" oscarDB=hinversion>\r\n<input type="hidden" name="ageComplex" id="ageComplex" oscarDB=ageComplex >\r\n<input type="hidden" name="age" id="age" oscarDB=age >\r\n<input type="hidden" name="sex" id="sex" oscarDB=sex >\r\n<input type="hidden" name="chartno" id="chartno" oscarDB=chartno >\r\n\r\n<input type="hidden" name="medical_history" id="medical_history" oscarDB=medical_history>\r\n<input type="hidden" name="recent_rx" id="recent_rx" oscarDB=recent_rx>\r\n<input type="hidden" name="druglist_generic" id="druglist_generic" oscarDB=druglist_generic>\r\n<input type="hidden" name="druglist_trade" id="druglist_trade" oscarDB=druglist_trade>\r\n<input type="hidden" name="druglist_line" id="druglist_line" oscarDB=druglist_line>\r\n<input type="hidden" name="social_family_history" id="social_family_history" oscarDB=social_family_history>\r\n<input type="hidden" name="other_medications_history" id="other_medications_history" oscarDB=other_medications_history>\r\n<input type="hidden" name="reminders" id="reminders" oscarDB=reminders>\r\n<input type="hidden" name="ongoingconcerns" id="ongoingconcerns" oscarDB=ongoingconcerns >\r\n\r\n<input type="hidden" name="provider_name_first_init" id="provider_name_first_init" oscarDB=provider_name_first_init >\r\n<input type="hidden" name="current_user" id="current_user" oscarDB=current_user >\r\n<input type="hidden" name="doctor_work_phone" id="doctor_work_phone" oscarDB=doctor_work_phone >\r\n<input type="hidden" name="doctor" id="doctor" oscarDB=doctor >\r\n\r\n<input type="hidden" name="today" id="today" oscarDB=today>\r\n\r\n<input type="hidden" name="allergies_des" id="allergies_des" oscarDB=allergies_des >\r\n\r\n<!-- PLACE REFERRAL PLACEHOLDERS HERE WHEN BC APCONFIG FIXED -->\r\n<input type="hidden" name="referral_name" id="referral_name" oscarDB=referral_name>\r\n<input type="hidden" name="referral_address" id="referral_address" oscarDB=referral_address>\r\n<input type="hidden" name="referral_phone" id="referral_phone" oscarDB=referral_phone>\r\n<input type="hidden" name="referral_fax" id="referral_fax" oscarDB=referral_fax>\r\n\r\n<!-- END OF DATABASE PLACEHOLDERS -->\r\n\r\n\r\n<!-- START OF MEASUREMENTS PLACEHOLDERS -->\r\n\r\n<input type="hidden" name="BP" id="BP" oscarDB=m$BP#value>\r\n<input type="hidden" name="WT" id="WT" oscarDB=m$WT#value>\r\n<input type="hidden" name="smoker" id="smoker" oscarDB=m$SMK#value>\r\n<input type="hidden" name="dailySmokes" id="dailySmokes" oscarDB=m$NOSK#value>\r\n<input type="hidden" name="A1C" id="A1C" oscarDB=m$A1C#value>\r\n\r\n<!-- END OF MEASUREMENTS PLACEHOLDERS -->\r\n\r\n\r\n<!-- START OF DERIVED PLACEHOLDERS -->\r\n\r\n<input type="hidden" name="he_she" id="he_she" value="he">\r\n<input type="hidden" name="his_her" id="his_her" value="his">\r\n<input type="hidden" name="gender" id="gender" value="male">\r\n<input type="hidden" name="referral_nameL" id="referral_nameL" value="Referring Doctor">\r\n<input type="hidden" name="letterhead" id="letterhead" value="Letterhead">\r\n\r\n<!-- END OF DERIVED PLACEHOLDERS -->\r\n\r\n\r\n<textarea name="Letter" id="Letter" style="width:600px; display: none;"></textarea>\r\n\r\n<div class="DoNotPrint" id="control3" style="position:absolute; top:20px; left: 660px;">\r\n<input type="button" class="butn" name="AddLetterhead" id="AddLetterhead" value="Letterhead" \r\n	onclick="doHtml(document.getElementById(\'letterhead\').value);">\r\n\r\n<br>\r\n<!--\r\n<input type="button" class="butn" name="certificate" value="Work Note" \r\n	onclick="document.RichTextLetter.AddLetterhead.click();\r\n 	doHtml(\'<p>\'+doDate()+\'<p>This is to certify that I have today examined <p>\');\r\n	document.RichTextLetter.AddLabel.click();\r\n	doHtml(\'In my opinion, \'+document.getElementById(\'he_she\').value+\' will be unfit for \'+document.getElementById(\'his_her\').value+\' normal work from today to * inclusive.\');\r\n	document.RichTextLetter.Closing.click();">\r\n<br>\r\n\r\n<input type="button" class="butn" name="consult" value="Consult Letter" \r\n	onclick="  var ref=document.getElementById(\'referral_name\').value.toString(); var mySplitResult = ref.split(\',\');\r\n	var gender=document.getElementById(\'sex\').value; if (gender==\'M\'){gender=\'male\';}; if (gender==\'F\'){gender=\'female\';};\r\n	var years=document.getElementById(\'ageComplex\').value; if (years==\'\'){years=document.getElementById(\'age\').value + \'yo\';};\r\n	document.RichTextLetter.AddLetterhead.click();\r\n	doHtml(\'<p>\'+doDate()+\'<p>\');\r\n	document.RichTextLetter.AddReferral.click();\r\n	doHtml(\'<p>RE:&nbsp\');\r\n	document.RichTextLetter.AddLabel.click();\r\n	doHtml(\'<p>Dear Dr. \'+mySplitResult[0]+\'<p>Thank you for asking me to see this \'+years+ \' \' +gender);\r\n	document.RichTextLetter.Closing.click(); ">\r\n<br>\r\n-->\r\n<input type="button" class="butn" name="AddReferral" id="AddReferral" value="Referring Block" \r\n	onclick="doHtml(document.getElementById(\'referral_name\').value+\'<br>\'+ document.getElementById(\'referral_address\').value +\'<br>CANADA<br> Tel: \'+ document.getElementById(\'referral_phone\').value+\'<br>Fax:  \'+document.getElementById(\'referral_fax\').value);">\r\n\r\n<br>\r\n\r\n<input type="button" class="butn" name="AddLabel" id="AddLabel" value="Patient Block" \r\n	onclick="doHtml(document.getElementById(\'label\').value);">\r\n\r\n<br>\r\n\r\n<br>\r\n<input type="button"  class="butn" name="MedicalHistory" value="Recent History" width=30\r\n	onclick="var hist=parseText(document.getElementById(\'medical_history\').value); doHtml(hist);">\r\n<br>\r\n<input type="button"  class="butn" name="AddMedicalHistory" value="Full History" width=30\r\n	onclick="doHtml(document.getElementById(\'medical_history\').value); ">\r\n<br>\r\n<input type="button" class="butn" name="RecentMedications" id="RecentMedications" value="Recent Prescriptions"\r\n	onclick="doHtml(document.getElementById(\'recent_rx\').value);">\r\n<br>\r\n<input type="button" class="butn" name="Medlist" id="Medlist" value="Medication List"\r\n	onclick="doHtml(document.getElementById(\'druglist_trade\').value);">\r\n<br>\r\n<input type="button" class="butn" name="Allergies" id="Allergies" value="Meds & Allergies"\r\n	onclick="var allergy=document.getElementById(\'allergies_des\').value; if (allergy.length>0){allergy=\'<br>Allergies: \'+allergy};doHtml(\'Medications: \'+document.getElementById(\'druglist_line\').value+allergy);">\r\n<br>\r\n<input type="button" class="butn" name="OtherMedicationsHistory" value="Family History"\r\n	onclick="var hist=parseText(document.getElementById(\'other_medications_history\').value); doHtml(hist);">\r\n<br>\r\n<input type="button" class="butn" name="AddOtherMedicationsHistory" value="Full Family Hx"\r\n	onclick="doHtml(document.getElementById(\'other_medications_history\').value); ">\r\n\r\n<br>\r\n<input type="button" class="butn" name="AddSocialFamilyHistory" value="Social History" \r\n	onclick="var hist=parseText(document.getElementById(\'social_family_history\').value); doHtml(hist);">\r\n<br>\r\n<input type="button" class="butn" name="AddReminders" value="Reminders"\r\n	onclick="var hist=parseText(document.getElementById(\'reminders\').value); doHtml(hist);">\r\n<br>\r\n<input type="button" class="butn" name="AddOngoingConcerns" value="Ongoing Concerns"\r\n	onclick="var hist=parseText(document.getElementById(\'ongoingconcerns\').value); doHtml(hist);">\r\n<br>\r\n<br>\r\n<input type="button" class="butn" name="Patient" value="Patient Name"\r\n	onclick=" doHtml(document.getElementById(\'first_last_name\').value);">\r\n\r\n<br>\r\n<input type="button" class="butn" name="PatientAge" value="Patient Age"\r\n	onclick="var hist=document.getElementById(\'ageComplex\').value; if (hist==\'\'){hist=document.getElementById(\'age\').value;}; doHtml(hist);">\r\n<br>\r\n<input type="button" class="butn" name="label" value="Patient Label"\r\n	onclick="var hist=document.getElementById(\'label\').value; doHtml(hist);">\r\n\r\n\r\n<br>\r\n<input type="button" class="butn" name="PatientSex" value="Patient Gender"\r\n	onclick="doHtml(document.getElementById(\'sex\').value);">\r\n<br>\r\n<br>\r\n<input type="button" class="butn" name="Closing" value="Closing Salutation" \r\n	onclick=" doHtml(\'<p>Yours Sincerely<p>&nbsp;<p>\'+ document.getElementById(\'provider_name_first_init\').value+\', MD\');">\r\n \r\n<br>\r\n<input type="button" class="butn" name="User" value="Current User"\r\n	onclick="var hist=document.getElementById(\'current_user\').value; doHtml(hist);">\r\n \r\n<br>\r\n<input type="button" class="butn" name="Doctor" value="Attending Doctor"\r\n	onclick="var hist=document.getElementById(\'doctor\').value; doHtml(hist);">\r\n<br>\r\n<br>\r\n\r\n\r\n<br>\r\n</div>\r\n\r\n\r\n<div class="DoNotPrint" >\r\n<input onclick="viewsource(this.checked)" type="checkbox">\r\nHTML Source\r\n<input onclick="usecss(this.checked)" type="checkbox">\r\nUse CSS\r\n	<table><tr><td>\r\n		 Subject: <input name="subject" id="subject" size="40" type="text">\r\n		 <input value="Submit" name="SubmitButton" type="submit" onclick="needToConfirm=false;document.getElementById(\'Letter\').value=editControlContents(\'edit\');  document.RichTextLetter.submit()">\r\n		 <input value="Reset" name="ResetButton" type="reset">\r\n		 <input value="Print" name="PrintButton" type="button" onclick="document.getElementById(\'edit\').contentWindow.print();">\r\n		 <input value="Print & Save" name="PrintSaveButton" type="button" onclick="document.getElementById(\'edit\').contentWindow.print();needToConfirm=false;document.getElementById(\'Letter\').value=editControlContents(\'edit\');  setTimeout(\'document.RichTextLetter.submit()\',1000);">\r\n	 </td></tr></table>\r\n </div>\r\n </form>\r\n\r\n</body></html>' where fid=1 and form_name='letter';
