<!--  
/*
 * 
 * Copyright (c) 2001-2002. Department of Family Medicine, McMaster University. All Rights Reserved. *
 * This software is published under the GPL GNU General Public License. 
 * This program is free software; you can redistribute it and/or 
 * modify it under the terms of the GNU General Public License 
 * as published by the Free Software Foundation; either version 2 
 * of the License, or (at your option) any later version. * 
 * This program is distributed in the hope that it will be useful, 
 * but WITHOUT ANY WARRANTY; without even the implied warranty of 
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the 
 * GNU General Public License for more details. * * You should have received a copy of the GNU General Public License 
 * along with this program; if not, write to the Free Software 
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA. * 
 * 
 * <OSCAR TEAM>
 * 
 * This software was written for the 
 * Department of Family Medicine 
 * McMaster University 
 * Hamilton 
 * Ontario, Canada 
 */
-->

<html>
<head>
	<title>PATIENT DETAIL INFO</title>
	<link rel="stylesheet" href="../web.css"/>
	<script language="JavaScript">
		function setfocus()
		{
			this.focus();
			document.swipecard.card_no.focus();
			document.swipecard.card_no.select();
		}

		// Card validation has to occur before we pass a card to addnewdemographicswipe
		// To ensure we're reading the card(s) correctly, we're whitelisting cards based off the prefix we read
		function isWhitelisted(card)
		{
			card = card.toUpperCase();
			// BC standalone
			if (card.startsWith("%B610043"))
			{
				return true;
			}
			// BC Combined
			else if (card.startsWith("%BC") && card.substring(card.indexOf("?")).startsWith("?;636028"))
			{
				return true;
			}
			// Ontario
			else if (card.startsWith("%B610054"))
			{
				return true;
			}
			// Currently unsupported
			return false;
		}

		function validate()
		{
			var cardNo = document.swipecard.card_no.value;
			if (!cardNo)
			{
				alert("Incorrect value provided for card number");
				return false;
			}
			else
			{
				if (isWhitelisted(cardNo))
				{
					return true;
				}
				// Card is unsupported - clear data from card off screen before telling user error
				document.getElementById("card_no").value = "";
				alert("Card type not supported." +
						"\nCurrently support is enabled for health cards from the following provinces:" +
						"\n- BC" +
						"\n- Ontario");
				return false;
			}
		}
	</script>
</head>
<body onLoad="setfocus()" topmargin="0" leftmargin="0" rightmargin="0">
<table border="0" cellspacing="0" cellpadding="0" width="100%">
	<tr bgcolor="#486ebd">
		<th align=CENTER NOWRAP><font face="Helvetica" color="#FFFFFF">PATIENT'S
			DETAIL RECORD</font></th>
	</tr>
</table>
<table BORDER="0" CELLPADDING="1" CELLSPACING="0" WIDTH="100%"
       BGCOLOR="#C4D9E7">
	<form method="post" name="swipecard"
	      action="addnewdemographicswipe.jsp" onsubmit="return validate();">
		<tr valign="top">
			<td rowspan="2" ALIGN="right" valign="middle">
				<font face="Verdana" color="#0000FF"><b><i>Swipe Card </i></b></font>
			</td>

			<td valign="middle" rowspan="2" ALIGN="left">
				<input type="text" NAME="card_no" id="card_no" SIZE="60" MAXLENGTH="200">
				<INPUT TYPE="SUBMIT" NAME="displaymode" VALUE="Validate" SIZE="17"></td>
		</tr>
	</form>
</table>
<br>
<br>
<form>
	<input type="button" name="Button" value="Cancel" onclick=self.close();>
</form>
</body>
</html>
